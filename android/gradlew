#!/bin/sh

#
# Gradle start up script for POSIX generated by Gradle.
#
# This is a simplified version - download full wrapper from gradle.org

# Attempt to set JAVA_HOME if it's not already set
if [ -z "$JAVA_HOME" ]; then
    if [ -x "/usr/libexec/java_home" ]; then
        export JAVA_HOME="$(/usr/libexec/java_home)"
    fi
fi

# Resolve links
PRG="$0"
while [ -h "$PRG" ]; do
    ls=$(ls -ld "$PRG")
    link=$(expr "$ls" : '.*-> \(.*\)$')
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=$(dirname "$PRG")/"$link"
    fi
done

# Get the directory
PRGDIR=$(dirname "$PRG")
APP_HOME=$(cd "$PRGDIR/.." && pwd -P)

# Download gradle if not available
GRADLE_VERSION="8.5"
GRADLE_HOME="$HOME/.gradle/wrapper/dists/gradle-$GRADLE_VERSION-bin"

if [ ! -d "$GRADLE_HOME" ]; then
    echo "Downloading Gradle $GRADLE_VERSION..."
    mkdir -p "$HOME/.gradle/wrapper/dists"
    curl -L -o "/tmp/gradle-$GRADLE_VERSION-bin.zip" "https://services.gradle.org/distributions/gradle-$GRADLE_VERSION-bin.zip"
    unzip -q "/tmp/gradle-$GRADLE_VERSION-bin.zip" -d "$HOME/.gradle/wrapper/dists/"
    rm "/tmp/gradle-$GRADLE_VERSION-bin.zip"
fi

GRADLE_BIN="$HOME/.gradle/wrapper/dists/gradle-$GRADLE_VERSION/bin/gradle"

if [ -x "$GRADLE_BIN" ]; then
    exec "$GRADLE_BIN" "$@"
else
    echo "Error: Could not find Gradle. Please install Gradle manually or run:"
    echo "  brew install gradle"
    exit 1
fi
